{% extends '::base.html.twig' %}
{% block title %}Blog interface{% endblock %}

{% block body -%}
    <h1>{{ blog.nom }}</h1>
    
    <table class="record_properties table">
        <tbody>
            <tr>
                <th>Id</th>
                <th>Nom</th>
                <th>Plateforme</th>
                <th>Url</th>
                <th>Categorie</th>
                <th>Auteur</th>
                <th>Logo</th>
            </tr>
            <tr>
                <td>{{ blog.id }}</td>                
                <td>{{ blog.nom }}</td>
                <td>{% if(blog.plateforme) %}{{ blog.plateforme }}{% else %}Indéfini{% endif %}</td>
                <td><a target="_blank" href="{{ blog.url }}" title="{{ blog.nom }}">{{ blog.url }}</a></td>
                <td>{{ blog.categorie }}</td>
                <td>{{ blog.auteur }}</td>
                <td class="blog_logo">{% if blog.logo %}<img src="{{ asset(blog.getLogoWeb) }}" />{% endif %}</td>            
            </tr>
        </tbody>
    </table>
            
    {# Process Report here #}
    {% if process_report %}
        <div class="panel panel-default">            
            <div class="panel-body">
                <p>Last crawl date : {{ process_report['date']|date("d-m-Y") }}</p>
                <p>Number of visited links : {{ process_report['links'] }}</p>
                <p>Number of docs saved : {{ process_report['docs'] }}</p>
                <p>Bytes received : {{ process_report['bytes'] }}</p>
                <p>Process runtime : {{ process_report['time'] }}</p>
            </div>
        </div>
    {% endif %}  
    <p>Number of actual urls in database for {{ blog.nom }} : {{ article_count }}</p>
    
    
    {#<h4>You have collected {{ urls_count }} urls for this blog. Date : {{ blog.getUrlListDate()|date('d-m-Y') }}</h4>
    {% if urls_count != 0 %}
        <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingOne">            
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Show urls
                </a>
            </div>
            <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                    <table class="table table-hover">
                        <tr>
                            <th>Url</th>
                            <th>Delete</th>
                        </tr>
                        {% for url in urls %}
                            <tr>
                                <td>{{ url }}</td>
                                <td><a href="{{ path('blog_delete_url', {'id': blog.id, 'key': loop.index0 }) }}">X</a></td>
                            </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
    {% endif %}#}
    
{#    {% if process_report %}
        <p>Links followed: {{ process_report.links_followed }}</p>
        <p>Documents received: {{ process_report.files_received }}</p>
        <p>Bytes received: {{ process_report.bytes_received }} bytes.</p>
        <p>Process runtime: {{ process_report.process_runtime }} sec.</p>
    {% endif %}#}

{#    <a href="{{ path('blog') }}">Retour à la liste</a><br/>#}
{#    <a href="{{ path('blog_edit', {'id': entity.id}) }}">Modifier</a>#}

{#    {{ form(delete_form) }}#}
    <a href="{{ path('article', {'blog_id': blog.id}) }}">Articles</a><br/>

    <h3>Actions</h3>
    <a href="{{ path('blog_crawl_param_edit', {'id': blog.id}) }}">1. Crawler settings and testing</a><br/>
{#    <a id="btn_get_urls" href="">Show saved urls</a><br/>#}
    <a href="{{ path('article_crawl_results', {'blog_id': blog.id}) }}">2. Get url and html sources (full crawl)</a><br/>
{#    {% if urls_count != 0 %}
        <a href="{{ path('article_index', {'blog_id': blog.id}) }}">3. Fetch related content</a><br/>
    {% endif %}#}
{#    <div id="show_urls">
        {% if urls %}
            {% for url in urls %}
                {{ url }}<br/>
            {% endfor %}
        {% endif %}
    </div> #}
    
    <script type="text/javascript">
        $(document).ready(function(){            
            
            {#$("#show_urls").hide();
            
            // Affichage des urls actuellement stockées
            $('#btn_get_urls').click(function(event){
                event.preventDefault();
                
                $("#show_urls").toggle("slow");
                return false;
            });#}
        });
    </script>
    
{% endblock %}



